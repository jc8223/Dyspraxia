<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Pop Game 🎈</title>
    <style>
        body {
            text-align: center;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 20px 10px;
            box-sizing: border-box;
        }
        h1 {
            font-size: 36px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 5px #000;
            margin: 10px 0;
        }
        #game-container {
            position: relative;
            width: 90vw;
            height: 60vh;
            max-width: 600px;
            max-height: 400px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            padding: 10px;
            margin-bottom: 20px;
        }
        .bubble {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff5722, #e64a19);
            color: white;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
            animation: float 2s infinite ease-in-out alternate;
            z-index: 1;
        }
        .bubble:hover {
            transform: scale(1.2);
            box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.4);
        }
        .hidden {
            color: transparent;
            background: #d3d3d3;
        }
        @keyframes float {
            from { transform: translateY(0px); }
            to { transform: translateY(-8px); }
        }
        #score, #level, #high-score, #timer {
            font-size: 22px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px #000;
            margin: 5px 0;
        }
        #message {
            font-size: 18px;
            color: white;
            margin-bottom: 10px;
            font-weight: bold;
        }
        #restart-btn {
            display: none;
            padding: 12px 20px;
            font-size: 20px;
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            cursor: pointer;
            margin: 20px auto;
            border-radius: 25px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
            width: auto;
            max-width: 90%;
        }
        #restart-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #ff4b2b, #ff416c);
        }
        .game-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px 20px;
            margin-bottom: 10px;
            width: 100%;
            max-width: 600px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }
            #score, #level, #high-score, #timer {
                font-size: 18px;
            }
            #message {
                font-size: 16px;
            }
            .bubble {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            #restart-btn {
                font-size: 18px;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }
            #score, #level, #high-score, #timer {
                font-size: 16px;
            }
            #message {
                font-size: 14px;
            }
            .bubble {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            #restart-btn {
                font-size: 16px;
                padding: 8px 12px;
            }
            .game-stats {
                gap: 5px 10px;
            }
        }
    </style>
</head>
<body>

    <h1>🎈 Memory Pop Game 🎈</h1>
    <div class="game-stats">
        <p id="level">Level: 1</p>
        <p id="score">Score: 0</p>
        <p id="high-score">High Score: 0</p>
        <p id="timer">Time Left: 10s</p>
    </div>
    <p id="message">Memorize the order before they disappear!</p>
    <div id="game-container"></div>
    <button id="restart-btn" onclick="restartGame()">🔄 Try Again</button>

    <script>
        let gameContainer = document.getElementById("game-container");
        let scoreDisplay = document.getElementById("score");
        let highScoreDisplay = document.getElementById("high-score");
        let levelDisplay = document.getElementById("level");
        let timerDisplay = document.getElementById("timer");
        let messageDisplay = document.getElementById("message");
        let restartBtn = document.getElementById("restart-btn");

        let score = 0;
        let highScore = localStorage.getItem("highScore") || 0;
        let numbers = [];
        let currentNumber = 1;
        let gameActive = false;
        let level = 1;
        let bubbleCount = 5;
        let memorizeTime = 5000;
        let roundTime = 10;
        let timer;
        let existingBubbles = [];

        highScoreDisplay.textContent = `High Score: ${highScore}`;

        function getRandomPosition() {
            let containerRect = gameContainer.getBoundingClientRect();
            let maxX = containerRect.width - 75;
            let maxY = containerRect.height - 75;

            const maxAttempts = 100;
            let attempts = 0;
            let position;
            let collision;

            do {
                position = {
                    x: Math.random() * maxX,
                    y: Math.random() * maxY
                };

                collision = false;
                for (let bubble of existingBubbles) {
                    const dx = position.x - bubble.x;
                    const dy = position.y - bubble.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // Minimum distance between bubbles (their radius * 2)
                    if (distance < 70) {
                        collision = true;
                        break;
                    }
                }

                attempts++;
                if (attempts >= maxAttempts) {
                    // If we can't find a non-overlapping position after many attempts,
                    // just return any position to prevent infinite loop
                    break;
                }
            } while (collision);

            existingBubbles.push(position);
            return position;
        }

        function createBubble(number) {
            let bubble = document.createElement("div");
            bubble.classList.add("bubble");
            let { x, y } = getRandomPosition();
            bubble.style.left = `${x}px`;
            bubble.style.top = `${y}px`;
            bubble.textContent = number;
            bubble.dataset.value = number;
            gameContainer.appendChild(bubble);
            numbers.push(number);
        }

        function hideNumbers() {
            let bubbles = document.querySelectorAll(".bubble");
            bubbles.forEach(bubble => {
                bubble.classList.add("hidden");
                bubble.style.pointerEvents = "auto";
            });
            gameActive = true;
            messageDisplay.textContent = "Now pop them in order!";
            startTimer();
        }

        function startTimer() {
            let timeLeft = roundTime;
            timerDisplay.textContent = `Time Left: ${timeLeft}s`;
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `Time Left: ${timeLeft}s`;
                if (timeLeft === 0) {
                    clearInterval(timer);
                    gameOver();
                }
            }, 1000);
        }

        function popBubble(event) {
            if (!gameActive) return;
            let clickedNumber = parseInt(event.target.dataset.value);
            if (clickedNumber === currentNumber) {
                event.target.remove();
                score += 10;
                scoreDisplay.textContent = `Score: ${score}`;
                currentNumber++;
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem("highScore", highScore);
                    highScoreDisplay.textContent = `High Score: ${highScore}`;
                }
                if (currentNumber > numbers.length) {
                    clearInterval(timer);
                    setTimeout(nextLevel, 1000);
                }
            } else {
                gameOver();
            }
        }

        function gameOver() {
            messageDisplay.textContent = "❌ Game Over! Try Again.";
            restartBtn.style.display = "block";
            gameActive = false;
            // Scroll the button into view if needed
            setTimeout(() => {
                restartBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        function restartGame() {
            level = 1;
            bubbleCount = 5;
            score = 0;
            scoreDisplay.textContent = `Score: 0`;
            restartBtn.style.display = "none";
            startGame();
        }

        function nextLevel() {
            level++;
            levelDisplay.textContent = `Level: ${level}`;
            bubbleCount += 2;
            memorizeTime = Math.max(3000, memorizeTime - 500);
            roundTime = Math.max(5, roundTime - 1);
            startGame();
        }

        function startGame() {
            gameContainer.innerHTML = "";
            numbers = [];
            currentNumber = 1;
            gameActive = false;
            existingBubbles = [];
            clearInterval(timer);
            for (let i = 1; i <= bubbleCount; i++) createBubble(i);
            setTimeout(hideNumbers, memorizeTime);
        }

        gameContainer.addEventListener("click", popBubble);
        startGame();
    </script>

</body>
</html>
